{% extends 'base_banner.html' %}
{% block headers_scripts_before_sqs %}
<script type="text/javascript"
        src="{{ url_for('static', filename='bower_components/jquery/dist/jquery.min.js') }}"></script>
<script type="text/javascript"
        src="{{ url_for('static', filename='bower_components/moment/min/moment.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/spin.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.spin.js') }}"></script>
<script type="text/javascript"
        src="{{ url_for('static', filename='bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}"/>
<link rel="stylesheet"
      href="{{ url_for('static', filename='bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css') }}"/>
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='listing.css') }}">
<script src="//www.parsecdn.com/js/parse-1.2.2.min.js"></script>

<link rel=stylesheet type=text/css href="{{ url_for('static', filename='dist/photoswipe.css') }}">
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='dist/default-skin/default-skin.css') }}">
<script src="{{ url_for('static', filename='dist/photoswipe.min.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='dist/photoswipe-ui-default.min.js') }}" type="text/javascript"></script>
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='stars.css') }}">
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='common.css') }}">
<script src="{{ url_for('static', filename='js/stars.js') }}" type="text/javascript"></script>

    <style>
        .dates-header {
            font-size: 1em;
            text-align: right;
        }

        .dates-value {
            text-align: left;
            margin: 1em;
            font-size: 1em;
        }

        table[class=pricing] tr td p {

    margin-bottom: 0.2em;
    color: black;
    font-size: 1em;
    font-weight: 300;
        }
    </style>
<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"-->
          <!--integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">-->

    <!--&lt;!&ndash; Optional theme &ndash;&gt;-->
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"-->
          <!--integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">-->

    <!--&lt;!&ndash; Latest compiled and minified JavaScript &ndash;&gt;-->
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"-->
            <!--integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"-->
            <!--crossorigin="anonymous"></script>-->
<!--<link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/newsletter_modal.css') }}">-->

{% endblock %}

{% block headers_scripts_after_sqs %}
{% endblock %}


{% block promoted_photo %}
<div id="promotedGalleryWrapper" class="sqs-layout promoted-gallery-wrapper">
    <div class="row">
        <div class="col"></div>
    </div>
</div>

<div class="banner-thumbnail-wrapper has-description" data-content-field="main-image"
     data-collection-id="569d7899b20943556a9928a2" data-edit-main-image="Banner"
     data-annotation-alignment="bottom left">

    <div class="color-overlay"></div>
    <figure id="thumbnail" class="loading content-fill"><img
            data-src="{{ listing.photos[0] }}"
            data-image="{{ listing.photos[0] }}" data-image-dimensions="1134x752"
            data-image-focal-point="0.5,0.5"/></figure>

    <div class="desc-wrapper" data-collection-id="569d7899b20943556a9928a2"><p><strong>{{ listing.headline
        }}</strong></p></div>
</div>
{% endblock %}


{% block content %}
<div class="sqs-layout sqs-grid-12 columns-12" data-type="page" data-updated-on="1453337911840"
     id="page-569d7899b20943556a9928a2">
    <div class="row sqs-row">
        <div class="col sqs-col-12 span-12">
            <div hidden class="sqs-block code-block sqs-block-code" data-block-type="23"
                 id="block-yui_3_17_2_4_1453240859384_11027">
                <div class="sqs-block-content">
                    <h1 class='text-align-center'>
                        <strong>{{ listing.headline }}</strong>
                    </h1>
                </div>
            </div>
            <div id="gallery" class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="pswp__bg"></div>
                <div class="pswp__scroll-wrap">
                    <div class="pswp__container">
                        <div class="pswp__item"></div>
                        <div class="pswp__item"></div>
                        <div class="pswp__item"></div>
                    </div>
                    <div class="pswp__ui pswp__ui--hidden">
                        <div class="pswp__top-bar">
                            <div class="pswp__counter"></div>
                            <button class="pswp__button pswp__button--close"
                                    title="Close (Esc)"></button>
                            <button class="pswp__button pswp__button--share" title="Share"></button>
                            <button class="pswp__button pswp__button--fs"
                                    title="Toggle fullscreen"></button>
                            <button class="pswp__button pswp__button--zoom"
                                    title="Zoom in/out"></button>
                            <div class="pswp__preloader">
                                <div class="pswp__preloader__icn">
                                    <div class="pswp__preloader__cut">
                                        <div class="pswp__preloader__donut"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                            <div class="pswp__share-tooltip">
                                <!-- <a href="#" class="pswp__share--facebook"></a>
                                <a href="#" class="pswp__share--twitter"></a>
                                <a href="#" class="pswp__share--pinterest"></a>
                                <a href="#" download class="pswp__share--download"></a> -->
                            </div>
                        </div>
                        <button class="pswp__button pswp__button--arrow--left"
                                title="Previous (arrow left)"></button>
                        <button class="pswp__button pswp__button--arrow--right"
                                title="Next (arrow right)"></button>
                        <div class="pswp__caption">
                            <div class="pswp__caption__center"></div>
                        </div>
                    </div><!--end pswp__ui pswp__ui--hidden-->
                </div><!--end pswp__scroll-wrap-->
            </div><!--end gallery-->


            {% if reservation %}
            <div id="reservation-container">
                {% if reservation.approved %}
                <p>You already have a booked reservation for {{ get_friendly_date(reservation.arrivalDate, true) }} - {{ get_friendly_date(reservation.departureDate, true) }}</p>
                {% else %}
                <p>You already have a pending reservation for {{ get_friendly_date(reservation.arrivalDate, true) }} - {{ get_friendly_date(reservation.departureDate, true) }}</p>
                {% endif %}
            </div>
            <div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" >
                <div class="sqs-block-content">
                    <hr/>
                </div>
            </div>
            {% endif %}
            <div class="header-text-block sqs-block html-block sqs-block-html" style="margin-top: 1em;"
                 data-block-type="2">
                <div class="sqs-block-content" style="text-align: center;">
                    <h2 class="text-align-center"><strong>{{ listing.headline }}</strong></h2>
                    <p id="listing-locality">{{ listing.placeDetails.city }}, {{ listing.placeDetails.state}}</p>
                    {% if listing.creator.avatar %}
                    <img style="width: 100px; height: 100px; border-radius: 50%; margin-top: 1em" src="{{ listing.creator.avatar }}"/>
                    {% else %}
                    <img style="width: 100px; height: 100px; border-radius: 50%; margin-top: 1em" src="http://res.cloudinary.com/djrymcpim/image/upload/v1456435560/hg66zztajz1tphgcwzjq.jpg"/>
                    {% endif %}
                    <p style="margin-top: 1em; font-size: 1em; color: #5d5d5d; font-family: proxima-nova-bold";>{{ listing.creator.firstName }} (Host)</p>
                    <!--<div style="margin: 1em 0;"><a style="color: white;" class="voyajoy-btn">Contact me</a></div>-->
                </div>
            </div>

            <div id='details-block' class="text-center">
                <p>Housing Type: {{ listing.housingType }}</p>
                <p>Bedrooms: {{ listing.bedrooms }}</p>
                <p>Bathrooms: {{ listing.bathrooms }}</p>
                <p>Room For: {{ listing.maxGuests }}</p>
                <p>Minimum Stay: {{ listing.minNights }} nights</p>
            </div>

            <div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47"
                 id="block-yui_3_17_2_2_1453161433238_26524">
                <div class="sqs-block-content">
                    <hr/>
                </div>
            </div>
            <!--<div class="header-text-block sqs-block html-block sqs-block-html" style="margin-top: 1em;"-->
                 <!--data-block-type="2">-->
                <!--<div class="sqs-block-content" style="text-align: center;">-->
                    <!--<h2 class="text-align-center"><strong>TL;DR</strong></h2>-->
                <!--</div>-->
            <!--</div>-->


            <div class="clearfix" style="text-align: center;"></div>
            <div class="well">
                <form action="/request" method="get">
                    <div id="voyajoy-datepicker">
                        <input type="hidden" name="id" value="{{ listing.objectId }}"/>
                        <input type="hidden" name="asdf" value="{{ listing.objectId }}"/>
                        <table>
                            <tr>
                                <td>
                                    <div class="form-group">
                                        <div class="input-header">
                                            Check In
                                        </div>
                                        <div class='input-group date' id='datetimepicker6'>
                                            <input type='text' class="form-control" name="start_date"
                                                   id="checkin-picker" autocomplete="off"/>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">

                                        <div class="input-header">
                                            Check Out
                                        </div>
                                        <div class='input-group date' id='datetimepicker7'>
                                            <input type='text' class="form-control" name="end_date" id="checkout-picker"
                                                   autocomplete="off"/>
                                        </div>
                                    </div>
                                <td>
                                    <div class="dropdown">
                                        <div class="input-header">
                                            Guests
                                        </div>
                                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                            <input hidden type='text' name="num_guests" id='num-guests-input'
                                                   value="1"/>
                                            <span id='num-guests'>1</span>
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                            <script type="text/javascript">
                                                var updateGuests = function (numGuests) {
                                                    $('#num-guests').text(numGuests);
                                                    $('#num-guests-input').val(numGuests + "");
                                                };
                                            </script>
                                            {% for x in range(listing.maxGuests) %}
                                            <li><a onclick="updateGuests({{ x + 1}})">{{ x + 1 }}</a></li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div style="display: none;" class="cost-overview-container">
                    <table class="pricing" style="border-collapse: separate; border-spacing: 1em 0em;">
                        <tr>
                            <td class="dates-header">
                                <p><span id="num-nights">1</span> nights:</p>
                            </td>
                            <td class="dates-value">
                                <p>
                                    {% if listing.discountedRate > 0 %}
                                    <span id="num-nights-times-price" style="text-decoration: line-through;">${{ listing.accomodationFee }}</span>
                                    <span style="color: #4CB448;" id="num_nights-times-price_with_discount">${{ (listing.accomodationFee - (listing.accomodationFee * ((listing.discountedRate|float)/100))) | int }}</span>
                                    {% else %}
                                    <span id="num-nights-times-price">${{ listing.accomodationFee }}</span>
                                    {% endif %}
                                </p>
                            </td>
                        </tr>
{#                        <ul style="list-style: none" id="pricing-list" />#}
                        {% if listing.cleaningFee > 0 %}
                        <tr>
                            <td class="dates-header" style="text-align: right;">
                                <p>Cleaning Fee:</p>
                            </td>
                            <td class="dates-value">
                                <p>${{ listing.cleaningFee }}</p>
                            </td>
                        </tr>
                        {% endif %}
                        {% if listing.securityDeposit > 0%}
                        <tr>
                            <td class="dates-header">
                                <p>Security Deposit:</p>
                            </td>
                            <td class="dates-value">
                                <p>${{ listing.securityDeposit }}</p>
                            </td>
                        </tr>
                        {% endif %}
                        <tr>
                            <td class="dates-header">
                                <p><strong>Total:</strong></p>
                            </td>
                            <td class="dates-value">
                                <p><strong><span id="total-pricing"></span></strong></p>
                            </td>
                        </tr>

                    </table>
                </div>
                    <div>
                        <div style="position: relative; padding: 0.7em 0; margin: 1em;" id="spinner"></div>
                    </div>
                    <p hidden id="availability-output">The dates you selected are not available. Please
                        select
                        different dates</p>
                    <script>
                    </script>
                    <input id="book-button" class="voyajoy-btn" disabled value="Request Booking" type="submit"/>
                </form>


            </div>
            <script type="text/javascript">

            </script>
            <script type="text/javascript">
                $(function () {
                    $('#checkin-picker').keydown(function() {
                       return false;
                    });
                    $('#checkout-picker').keydown(function() {
                       return false;
                    });

                    var calendar = null;

                    var rentalFee = {{ listing.accomodationFee }};
                    var cleaningFee = {{ listing.cleaningFee }};
                    var securityDeposit = {{ listing.securityDeposit }};
                    var discountedRate = {{ listing.discountedRate }};
                    var minNights = {{ listing.minNights }};

                    var nowTemp = new Date();
                    var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
                    var checkin = $('#datetimepicker6').datetimepicker({
                        format: "MM/DD/YYYY",
                        minDate: now
                    });
                    var checkout = $('#datetimepicker7').datetimepicker({
                        useCurrent: false, //Important! See issue #1075
                        format: "MM/DD/YYYY",
                        minDate: new moment(now).add(minNights, 'd')
                    });

                    var checkInData = checkin.data("DateTimePicker");
                    var checkOutData = checkout.data("DateTimePicker");

                    var spinner = new Spinner({
                    lines: 10, // The number of lines to draw
                    length: 4, // The length of each line
                    width: 2, // The line thickness
                    radius: 5, // The radius of the inner circle
                    color: '#000', // #rbg or #rrggbb
                    speed: 1, // Rounds per second
                    trail: 50, // Afterglow percentage
                    shadow: true // Whether to render a shadow
                });
                var getTotalRentalFees = function(numNights) {
                    if (discountedRate > 0) {
                        var totalDiscountPerNight = rentalFee * discountedRate / 100;
                        console.log(totalDiscountPerNight + " : " + discountedRate);
                        return (rentalFee - totalDiscountPerNight) * numNights;
                    }
                    return rentalFee * numNights;
                };

                var getTotal = function(numNights) {
                    return cleaningFee + securityDeposit + getTotalRentalFees(numNights);

                };

                var getCalendar = function() {
                        $.getJSON($SCRIPT_ROOT + '/_get_calendar', {
                            listing_id: '{{ listing.objectId }}'
                        }, function (data) {
                            if (data.results != null) {
                                checkInData.disabledDates(data.results);
                                var checkoutDates = [];
                                for (var i = 0; i < data.results.length; i++) {
                                    checkoutDates.push(moment(data.results[i]).add(1, 'd'));
                                }
                                checkOutData.disabledDates(checkoutDates);
                                calendar = data.results;
                                checkAvailability();
                            }

                        });
                        return false;
                    };

                    var getPricing = function() {
                        $.getJSON($SCRIPT_ROOT + '/_get_pricing', {
                            listing_id: '{{  listing.objectId }}',
                            start_date: $('#checkin-picker').val(),
                            end_date: $('#checkout-picker').val(),
                            num_guests: $('#num-guests-input').val()
                        }, function (data) {
                            if (data.success) {
                                updatePricingDynamic(data.totalPrice, data.results);
                            } else {
                                updatePricing();
                            }
                        });
                    }

                    var checkAvailabilityCalendar = function() {
                        var start_date = new moment($('#checkin-picker').val());
                        var end_date = new moment($('#checkout-picker').val());
                        var err = false;
                        var curr_date = start_date;
                        var errorMessage = '';
                        console.log(curr_date.format('MM/DD/YYYY') + " : " + end_date.format('MM/DD/YYYY'));
                        while (curr_date.format('MM/DD/YYYY') !== end_date.format('MM/DD/YYYY')) {
                            console.log(curr_date.format('MM/DD/YYYY') + " : " + end_date.format('MM/DD/YYYY'));
                            console.log(calendar);
                            console.log(curr_date.format('MM/DD/YYYY'));
                            if (calendar.contains(curr_date.format('MM/DD/YYYY'))) {
                                err = true;
                                errorMessage = 'The dates you selected are not available. Please select different dates';
                                break;
                            }
                            curr_date = curr_date.add(1, 'd');
                        }
                        if (!err) {
                            var checkinpi = $('#checkin-picker').val();
                            var checkoutpi = $('#checkout-picker').val();
                            var inm = new moment(checkinpi);
                            var outm = new moment(checkoutpi);
                            var checkdiff = outm.diff(inm, 'days');

                            if (checkdiff < minNights) {
                                err = true;
                                errorMessage = 'You must stay a minimum of ' + minNights + ' nights';
                            }
                        }
                        if (!err) {
                            getPricing();
                        }
                        spinner.stop();
                        updateContainer(!err, errorMessage);

                    };

                    var updateContainer = function(isDataAvailable, errorMessage) {
                        $('#availability-output').text(errorMessage);
                        if (!isDataAvailable) {
                            $('#availability-output').show();
                            $('.cost-overview-container').hide();
                        } else {
                            $('#availability-output').hide();
                            $('.cost-overview-container').show();
                            $('#book-button').prop('disabled', false);
                        }
                    }

                    var checkAvailabilityServer = function() {
                        $.getJSON($SCRIPT_ROOT + '/_is_available', {
                            start_date: $('#checkin-picker').val(),
                            end_date: $('#checkout-picker').val(),
                            listing_id: '{{ listing.objectId }}'
                        }, function (data) {
                            spinner.stop();
                            updateContainer(data.available, '')
                        });
                        return false;
                    };

                    var checkAvailability = function() {
                        spinner.spin(document.getElementById("spinner"));
                        console.log("getavail");
                        if (calendar != null) {
                            checkAvailabilityCalendar();
                        } else {
                            checkAvailabilityServer();
                        }
                    };

                    var updatePricingDynamic = function(totalPrice, results) {
//                        $('.cost-overview-container').show();
                        var diff = Math.floor(moment.duration(checkOutData.date().diff(checkInData.date())).days());
                        var total = Math.floor((rentalFee * (1 - discountedRate/100) * diff) + securityDeposit + cleaningFee);
{#                        $('#total-pricing').text("$" + Math.round(getTotal(diff)));#}
{#                        $('#pricing-list').clear();#}
                        for (var i = 0; i < results.length; i++) {
                            $('#pricing-list').append('<li>' + results[i].date + ': $' + results[i].price.local_price + '</li>');
                        }
                        $('#total-pricing').text("$" + Math.floor(totalPrice * (1 - discountedRate/100) + securityDeposit + cleaningFee));
                        $('#num-nights').text(diff);
                        $('#num-nights-times-price').text('$' + totalPrice);

                        if (discountedRate > 0) {
                            $('#num_nights-times-price_with_discount').text('$' + Math.floor(totalPrice * (1 - discountedRate/100)) + ' (' + discountedRate+'% off)');
                        }
                    };

                    var updatePricing = function() {
                        var diff = Math.round(moment.duration(checkOutData.date().diff(checkInData.date())).days());
                        var total = Math.round((rentalFee * (1 - discountedRate/100) * diff) + securityDeposit + cleaningFee);
                        $('#total-pricing').text("$" + Math.round(getTotal(diff)));
                        $('#num-nights').text(diff);
                        $('#num-nights-times-price').text('$' + diff * rentalFee);
                        if (discountedRate > 0) {
                            $('#num_nights-times-price_with_discount').text('$'+Math.round(getTotalRentalFees(diff))+' ('+discountedRate+'% off)');
                        }
                    };

                    checkInData.date(now);
                    checkOutData.date(new moment(now).add(minNights, 'd'));
                    checkin.on("dp.change", function (e) {
                        checkInData.hide();
                        checkOutData.minDate(e.date.add(minNights, 'd'));
                        if (checkOutData.date() == null) {
                            checkOutData.date(e.date.add(minNights, 'd'));
                        } else {
                            if (checkInData.date() >= checkOutData.date()) {
                                checkOutData.date(e.date);
                            }
                            console.log("getavail1");
                            checkAvailability();
                        }

                    });
                    checkout.on("dp.change", function (e) {
                        checkOutData.hide();
                        checkAvailability()
                    });

                    if (calendar == null) {
                        getCalendar();
                    }

                    $('#datetimepicker6').click(function () {
                        checkInData.show();
//
                    });

                    $('#datetimepicker7').click(function () {
                        checkOutData.show();
                    });

                });
            </script>
        </div>

    </div>
</div>
<div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47"
     id="block-yui_3_17_2_2_1453161433238_22016">
    <div class="sqs-block-content">
        <hr/>
    </div>
</div>

<div class="header-text-block sqs-block html-block sqs-block-html" style="margin-top: 1em;"
     data-block-type="2"
>
    <div class="sqs-block-content"><h2 class="text-align-center"><strong>PHOTOS</strong></h2>
    </div>

</div>

    <div class="sqs-block gallery-block sqs-block-gallery"
     data-block-json="&#123;&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;methodOption&quot;:&quot;existing&quot;,&quot;existingGallery&quot;:&quot;569c41c889a60a5a2b71fdae&quot;,&quot;design&quot;:&quot;slideshow&quot;,&quot;aspectRatio&quot;:null,&quot;autoplay&quot;:false,&quot;controls&quot;:true,&quot;auto-crop&quot;:true,&quot;thumbnails&quot;:true,&quot;thumbnail-strip-height&quot;:85,&quot;thumbnail-strip-margin&quot;:10,&quot;show-meta&quot;:true,&quot;meta-position&quot;:&quot;bottom&quot;,&quot;show-meta-on-hover&quot;:false,&quot;collectionId&quot;:&quot;569c41c889a60a5a2b71fdae&quot;,&quot;existingGalleryId&quot;:&quot;569c41c889a60a5a2b71fdae&quot;,&quot;vSize&quot;:null&#125;"
     data-block-type="8" id="block-yui_3_17_2_9_1453160293555_5328">
    <div id="asdff" class="sqs-block-content">
        <script type="text/javascript">
                var openPhotoSwipe = function () {
                    var pswpElement = document.querySelectorAll('.pswp')[0];

                    // build items array
                    var items = [
                        {% for p in listing.photos %}
                        {
                            src: '{{ p }}',
                            w: 1200,
                            h: 800
                        },
                        {% endfor %}
                    ];

                    // define options (if needed)
                    var options = {
                        // optionName: 'option value'
                        // for example:
                        index: 0, // start at first slide
                        history: false,
                        focus: false,
                        showAnimationDuration: 0,
                        hideAnimationDuration: 0
                    };

                    // Initializes and opens PhotoSwipe
                    var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
                    gallery.init();
                };
                $("#asdff").click(function () {
                    openPhotoSwipe();
                    return false;
                });


            </script>
        <div class="
                        sqs-gallery-container
                        sqs-gallery-block-slideshow


                        sqs-gallery-has-controls
                        sqs-gallery-has-thumbnails


                        sqs-gallery-block-show-meta sqs-gallery-block-meta-position-bottom


                        clear
                        ">

            <div class="sqs-gallery">

                {% for photo in listing.photos %}
                <div class="slide content-fill" data-type="image" data-click-through-url="">
                    <noscript><img src="{{ photo }}"/>
                    </noscript>
                    <img style="cursor: pointer; object-fit: contain !important;"  class="thumb-image" alt="bookcase.jpg"
                         data-src="{{ photo }}"
                         data-image="{{ photo }}"
                         data-image-dimensions="1134x752" data-image-focal-point="0.5,0.5"
                         data-load="false" data-image-id="569c41d2dc5cb4298585539c"
                         data-type="image"/>
                    <div class="color-overlay"></div>
                </div>
                {% endfor %}


            </div>


            <div class="sqs-gallery-meta-container">


                <div class="sqs-gallery-controls">
                    <a href="#" class="previous"></a>
                    <a href="#" class="next"></a>
                </div>


            </div> <!-- END .sqs-gallery-meta-container -->


        </div>


        <div class="sqs-gallery-thumbnails">

            {% for photo in thumbnails %}
            <img data-load="false" data-src="{{ photo }}"
                 data-image="{{ photo }}"
                 data-image-dimensions="1134x752" data-image-focal-point="0.5,0.5"
                 data-type="image"/>
            {% endfor %}

        </div>
        </div>

        <div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47"
             id="block-yui_3_17_2_2_1453161433238_26524">
            <div class="sqs-block-content">
                <hr/>
            </div>
        </div>

{% if listing.amenities  %}
<div class="header-text-block sqs-block html-block sqs-block-html" data-block-type="2"
     id="block-yui_3_17_2_1_1453160293555_43072">
    <div class="sqs-block-content"><h2 class="text-align-center"><strong>Amenities</strong></h2>
    </div>
</div>
<div class="sqs-block code-block sqs-block-code" data-block-type="23"
     id="block-yui_3_17_2_4_1453240859384_40511">
    <div class="sqs-block-content"><p>
        <span class="listing-header-span">
            <ul id="amenities-container">
                {% for a in listing.amenities %}
                <li>{{ a | safe }}</li>
                {% endfor %}
            </ul>
        </span>
    </p></div>
</div>
<div class="sqs-block spacer-block sqs-block-spacer sized vsize-1" data-block-type="21"
     id="block-yui_3_17_2_3_1453834542345_11702">
    <div class="sqs-block-content">&nbsp;</div>
</div>
{% endif %}

{% if listing.overviewText  %}
<div class="header-text-block sqs-block html-block sqs-block-html" data-block-type="2"
     id="block-yui_3_17_2_1_1453160293555_43072">
    <div class="sqs-block-content"><h2 class="text-align-center"><strong>Overview</strong></h2>
    </div>
</div>
<div class="sqs-block code-block sqs-block-code" data-block-type="23"
     id="block-yui_3_17_2_4_1453240859384_40511">
    <div class="sqs-block-content"><p id="overviewText">
        <span class="listing-header-span">{{ listing.overviewText | safe}}</span>
    </p></div>
</div>
<div class="sqs-block spacer-block sqs-block-spacer sized vsize-1" data-block-type="21"
     id="block-yui_3_17_2_3_1453834542345_11702">
    <div class="sqs-block-content">&nbsp;</div>
</div>
{% endif %}
{% if listing.placeText %}
<div class="header-text-block sqs-block html-block sqs-block-html" data-block-type="2"
     id="block-yui_3_17_2_2_1453161433238_23808">
    <div class="sqs-block-content"><h2 class="text-align-center"><strong>The Place</strong></h2>
    </div>
</div>
<div class="sqs-block code-block sqs-block-code" data-block-type="23"
     id="block-yui_3_17_2_4_1453240859384_102242">
    <div class="sqs-block-content">
        <p id="placeText">
            <span class="listing-header-span">{{ listing.placeText | safe }}</span>
        </p>
    </div>
</div>
<div class="sqs-block spacer-block sqs-block-spacer sized vsize-1" data-block-type="21"
     id="block-yui_3_17_2_3_1453834542345_11702">
    <div class="sqs-block-content">&nbsp;</div>
</div>
{% endif %}
{% if listing.neighborhoodText %}
<div class="header-text-block sqs-block html-block sqs-block-html" data-block-type="2"
     id="block-yui_3_17_2_2_1453161433238_24767">
    <div class="sqs-block-content"><h2 class="text-align-center"><strong>The
        Neighborhood</strong></h2></div>
</div>
<div class="sqs-block code-block sqs-block-code" data-block-type="23"
     id="block-yui_3_17_2_4_1453240859384_103738">
    <div class="sqs-block-content">
        <p id="neighborhoodText">
            <span class="listing-header-span">{{ listing.neighborhoodText | safe }}</span>
        </p>
    </div>
</div>
<div class="sqs-block spacer-block sqs-block-spacer sized vsize-1" data-block-type="21"
     id="block-yui_3_17_2_3_1453834542345_11702">
    <div class="sqs-block-content">&nbsp;</div>
</div>
{% endif %}
{% if listing.houseRulesText %}
<div class="header-text-block sqs-block html-block sqs-block-html" data-block-type="2"
     id="block-yui_3_17_2_2_1453161433238_25697">
    <div class="sqs-block-content"><h2 class="text-align-center"><strong>House Rules</strong>
    </h2></div>
</div>
<div class="sqs-block code-block sqs-block-code" data-block-type="23"
     id="block-yui_3_17_2_3_1453337106982_18501">
    <div class="sqs-block-content">
        <p id="houseRules">
            <span class="listing-header-span">{{ listing.houseRulesText | safe }}</span>
        </p>
    </div>
</div>
<div class="sqs-block spacer-block sqs-block-spacer sized vsize-1" data-block-type="21"
     id="block-yui_3_17_2_3_1453834542345_11702">
    <div class="sqs-block-content">&nbsp;</div>
</div>
{% endif %}

<div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47"
     id="block-yui_3_17_2_2_1453161433238_26524">
    <div class="sqs-block-content">
        <hr/>
    </div>
</div>

    <div class="header-text-block sqs-block html-block sqs-block-html" style="margin-top: 1em;"
         data-block-type="2">
        <div class="sqs-block-content"><h2 class="text-align-center"><strong>MAP</strong></h2>
        </div>
    </div>
    <div class="sqs-block map-block sqs-block-map sized vsize-12"
         data-block-json="&#123;&quot;location&quot;:&#123;&quot;mapLat&quot;:{{ place.latLng.latitude }},&quot;mapLng&quot;:{{ place.latLng.longitude }},&quot;mapZoom&quot;:12,&quot;markerLat&quot;:{{ place.latLng.latitude }},&quot;markerLng&quot;:{{ place.latLng.longitude }},&quot;addressLine1&quot;:&quot;{{ place.street }}&quot;,&quot;addressLine2&quot;:&quot;{{ place.city }}, {{ place.state }} {{ place.zipcode }}&quot;,&quot;addressCountry&quot;:&quot;{{ place.country }}&quot;,&quot;addressTitle&quot;:&quot;&quot;&#125;,&quot;vSize&quot;:12,&quot;style&quot;:1,&quot;labels&quot;:true,&quot;terrain&quot;:false,&quot;controls&quot;:false,&quot;hSize&quot;:null,&quot;floatDir&quot;:null&#125;"
         data-block-type="4" id="block-yui_3_17_2_1_1453160293555_48881">
        <div class="sqs-block-content">&nbsp;</div>
    </div>

    <div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47"
     id="block-yui_3_17_2_2_1453161433238_26524">
    <div class="sqs-block-content">
        <hr/>
    </div>
</div>

<div class="header-text-block sqs-block html-block sqs-block-html" data-block-type="2"
     id="block-yui_3_17_2_2_1453161433238_25697">
    <div class="sqs-block-content"><h2 class="text-align-center"><strong>Reviews ({{ listing.reviewCount }})</strong>
    </h2></div>
    {% if listing.reviewRating %}
    <div><span style="margin: 1em auto;" class="stars">{{ listing.reviewRating | int }}</span></div>
    {% endif %}
</div>

{% for review in listing.reviews %}
{% include 'list_item_review.html' %}
{% endfor %}

{% if listing.reviewRating %}
<script type="text/javascript">
    $(function () {
        $('span.stars').stars();
    });
</script>
{% endif %}

{% endblock %}
